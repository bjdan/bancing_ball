# 躲避球（pygame 教学游戏）— 需求与里程碑

> 面向对象：中学生；目标：用最少的 Python 高级特性完成一个可玩的 pygame 小游戏。
> 代码约束：不使用类与复杂类型标注，尽量用列表、字典、元组、基本函数与常量，结构清晰、注释充分。

## 技术与运行
- 依赖：`python 3.10+`，`pygame`
- 运行（后续实现后）：`python src/main.py`
- 分辨率建议：`800x600`

## 核心玩法
- 控制小人（键盘方向键或 WASD）在屏幕内移动。
- 多个弹球匀速运动，撞到屏幕边界反弹。
- 小人与弹球碰撞：扣除生命值；生命为 0 时游戏结束。
- 存活时间越长，难度越高（弹球数量或速度增加），得分随存活时间与难度提升累计。

## 核心数据结构（规划）
- `player`: 字典，含位置、速度、半径、生命、无敌计时等。
- `balls`: 列表，内含若干元组/字典，记录每个球的 `x, y, vx, vy, r, color`。
- `level`: 字典，记录难度、计时、生成频率、速度上限、最大球数。
- `score`: 整数；`state`: 字符串（"ready" / "playing" / "gameover"）。

## 里程碑（由简到繁）

### M1：弹球基础（无玩家）
- 在屏幕上生成 3–5 个弹球，初始方向、颜色、大小各不相同。
- 弹球以常量速度移动，遇到屏幕边缘发生镜面反弹。
- 完成：窗口、时钟、事件循环、清屏与绘制逻辑。
- 验收：弹球持续运动且无卡顿，窗口可关闭。

### M2：加入玩家小人与基本碰撞
- 使用键盘控制一个方块或其它非圆形小人（与弹球区别明显）。
- 限制小人不离开屏幕边界。
- 与弹球的碰撞检测（圆-矩形近似或精确检测均可）：碰撞时扣除生命值（例如每次 -20）。
- 屏幕左上角显示生命值：数字 + 血条（同时显示）。
- 验收：可操作，碰撞能扣血，生命为 0 时切换到“游戏结束”状态。

### M3：基础 UI 与状态切换
**目标**
- 引导学生把“状态机”概念应用到游戏循环，理解同一循环在不同状态下执行不同逻辑。

**必须实现**
- 维护 `state` 字符串，至少包含 `"ready"`、`"playing"`、`"gameover"` 三种取值，初始为 `"ready"`。
- `ready` 状态：暂停更新逻辑，只显示提示文本；按 `Space/Enter` 启动新一局（重置玩家、弹球、分数）。
- `playing` 状态：推进弹球与玩家逻辑，实时累积分数，并在 HUD 上显示生命值、当前分数与最高分。
- `gameover` 状态：当生命值归零时触发，停止更新弹球/玩家，显示“Game Over”与重开提示；按 `Space/Enter` 回到 `playing`。
- 最高分保存在内存中（同一进程内有效），刷新时实时更新 HUD。

**建议实现（可选）**
- 支持 `P` 键在 `playing` 状态下切换 `paused`，暂停更新但保留渲染；再次按下恢复。
- 在 `ready`/`gameover` 状态给出更详细的教学提示（操作说明、游戏目标等）。

**验收标准**
- 进入游戏先看到 `ready` 提示，按键后进入 `playing` 并可正常操作。
- 生命值归零后自动切换到 `gameover`，界面提示明显，可按键立即重开。
- HUD 始终显示生命值、实时分数与最高分，分数在多轮游戏中累积表现正确。
### M4：难度与关卡提升
**目标**
- 让学生体会“状态驱动数值变化”的设计，理解如何用额外字典记录难度与计时信息。

**必须实现**
- 新增 level 字典（或等价结构），至少包含：level_index（当前关卡）、	imer（累计生存时间）、all_max、speed_max。
- 每隔固定时间（建议 10~15 秒）提高难度：
  - 先尝试“方案 A：按关卡追加弹球，直到达到 all_max”；
  - 如果球已达上限，再提高所有球的速度上限（speed_max），并据此刷新球速。
- 分数与难度挂钩：基础分每秒 1 分，每升一级额外 +0.5（可写成 ase + level_index * 0.5）。
- HUD 中显示当前关卡（如 Level 3），提示玩家难度变化。

**建议实现（可选）**
- 难度提升时播放短暂提示（闪烁文本或提示语）。
- 依据难度调整玩家受伤冷却或球颜色，以便视觉上感知。

**验收标准**
- 在 1~2 分钟内可观察到弹球数量或速度显著增加。
- 分数随关卡提升而加快累积，刷新最高分时能体现难度影响。
- HUD 上关卡显示与内部难度数据一致，不出现倒退或跳级。

### M5：视觉与音效（可选）
- 更友好的配色、背景色或简易背景图。
- 播放音效：碰撞（受伤）、升级、开始/结束。
- 验收：不会影响性能，音量适中，可静音开关（按 `M`）。

### M6：打磨与教学注释
- 代码模块化但不使用类：将配置、绘图、碰撞、难度提升等逻辑用函数拆分。
- 在关键函数和数据结构上增加面向学生的解释性注释。
- 在 `docs/` 加入一页“讲解提纲”（可选）。
- 验收：学生读代码能理解主要流程与数据如何变化。

## 评分与结束条件
- 生命值归零：显示“Game Over”与最终分数，可按键重试。
- 分数计算：基于生存时间与难度等级的累计值。
- 最高分记录：本轮进程内的最高分（文件持久化可选）。

## 项目结构（建议）
- `src/main.py`：入口，主循环与状态机。
- `src/config.py`：常量与可调参数（分辨率、颜色、初始球数、速度上限等）。
- `src/game_logic.py`：球运动、碰撞、难度提升相关的函数。
- `assets/`：图片与音效（前期可为空）。
- `docs/requirements.md`：本文档。

## 开放扩展（可选）
- 道具：护盾、加速、回血。
- 不同大小与质量的球（反弹速度变化）。
- 多人模式或 AI 演示。
